import { createClient } from './supabase/server'\nimport { cookies } from 'next/headers'\nimport { redirect } from 'next/navigation'\nimport { db } from './database'\nimport { users } from '../shared/schema'\nimport { eq } from 'drizzle-orm'\n\nexport async function getUser() {\n  const cookieStore = cookies()\n  const supabase = createClient(cookieStore)\n  \n  const {\n    data: { user },\n    error,\n  } = await supabase.auth.getUser()\n\n  return user\n}\n\nexport async function requireAuth() {\n  const user = await getUser()\n  \n  if (!user) {\n    redirect('/auth')\n  }\n  \n  return user\n}\n\nexport async function getUserProfile(userId: string) {\n  const [profile] = await db\n    .select()\n    .from(users)\n    .where(eq(users.id, userId))\n    .limit(1)\n    \n  return profile\n}\n\nexport async function createUserProfile(supabaseUser: any) {\n  const [profile] = await db\n    .insert(users)\n    .values({\n      id: supabaseUser.id,\n      email: supabaseUser.email,\n      role: 'student', // Default role\n      firstName: supabaseUser.user_metadata?.firstName || '',\n      lastName: supabaseUser.user_metadata?.lastName || '',\n      emailVerified: true,\n      accountApproved: true,\n      isActive: true,\n    })\n    .returning()\n    \n  return profile\n}"